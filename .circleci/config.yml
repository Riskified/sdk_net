version: 2

jobs:
  build:
    docker:
      - image: cimg/base:2021.04
    steps:
      - checkout
      #- run: 
       #   name: "Downloads the package lists from the repository"
        #  command: sudo apt-get update
      - run: wget https://packages.microsoft.com/config/ubuntu/21.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
      - run: sudo dpkg -i packages-microsoft-prod.deb
      - run: rm packages-microsoft-prod.deb
      - run: sudo apt-get update
      - run: sudo apt-get install -y apt-transport-https
      - run: sudo apt-get update
      - run: sudo apt-get install -y dotnet-sdk-6.0 
      - run: dotnet --version
      
      - run: # print the name of the branch we're on
          name: "what version am I using "
          command: echo dotnet --version
      - run: 
          name: "Install Nuget, Mono-devel and Mono-XBuild"
          command: sudo apt-get install -y nuget mono-devel mono-xbuild
      - run: 
          name: "Updating Nuget to most recent version"
          command: sudo nuget update -self
      - run: 
          name: "Downloading project dependencies"
          command: nuget restore SDK_NET.sln
      - run: 
          name: "Mono version"
          command: mono --version
      - run: 
          name: "Build and release binaries"
          command: xbuild SDK_NET.sln
          #command: xbuild /p:Configuration=Release SDK_NET.sln
      - run: 
          name: "Nuget pack"
          command: ls
          command: pwd
          command: nuget pack Riskified.SDK/Riskified.SDK.csproj
      - run: 
          command: ls
    
workflows:
  version: 2
  build_and_deploy:
    jobs:
      - build:
          filters: 
            branches:
              only: TIS-361
